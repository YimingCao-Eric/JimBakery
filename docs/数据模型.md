# 数据模型设计

> 基于 MongoDB 设计，若使用 MySQL 可将 ObjectId 转为自增主键，部分字段类型需调整。

---

## 1. 用户表 (users)

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| _id | ObjectId | 是 | 主键 |
| openid | String | 是 | 微信 openid，唯一 |
| unionid | String | 否 | 微信 unionid（开放平台） |
| nickname | String | 否 | 昵称 |
| avatar | String | 否 | 头像 URL |
| phone | String | 否 | 手机号 |
| role | String | 是 | 角色：user / admin |
| addresses | Array | 否 | 收货地址列表 |
| createdAt | Date | 是 | 创建时间 |
| updatedAt | Date | 是 | 更新时间 |

**addresses 子结构：**
```json
{
  "name": "收货人",
  "phone": "13800138000",
  "region": "省市区",
  "detail": "详细地址",
  "isDefault": true
}
```

**索引建议：**
- `openid`：唯一索引（登录、去重）
- `phone`：普通索引（手机号查询、找回）
- `createdAt`：普通索引（按时间排序）

---

## 2. 商品分类表 (categories)

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| _id | ObjectId | 是 | 主键 |
| name | String | 是 | 分类名称 |
| icon | String | 否 | 图标 URL |
| sort | Number | 是 | 排序（升序） |
| isActive | Boolean | 是 | 是否启用，默认 true |
| createdAt | Date | 否 | 创建时间 |
| updatedAt | Date | 否 | 更新时间 |

**索引建议：**
- `sort`：普通索引（菜单排序）
- `isActive`：普通索引（筛选启用分类）

---

## 3. 商品表 (products)

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| _id | ObjectId | 是 | 主键 |
| name | String | 是 | 商品名称 |
| categoryId | ObjectId | 是 | 分类 ID |
| price | Number | 是 | 售价 |
| originalPrice | Number | 否 | 原价 |
| stock | Number | 是 | 库存 |
| images | Array | 是 | 图片 URL 数组 |
| description | String | 否 | 描述 |
| specs | Array | 否 | 规格选项 |
| sales | Number | 是 | 销量，默认 0 |
| isActive | Boolean | 是 | 是否上架，默认 true |
| createdAt | Date | 否 | 创建时间 |
| updatedAt | Date | 否 | 更新时间 |

**specs 子结构：**
```json
{
  "name": "规格名（如：口味）",
  "options": ["原味", "巧克力", "草莓"]
}
```

**索引建议：**
- `categoryId`：普通索引（按分类查询）
- `isActive`：普通索引（筛选在售商品）
- `sales`：普通索引（热销排序）
- `categoryId + isActive`：复合索引（分类页列表）

---

## 4. 购物车表 (carts)

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| _id | ObjectId | 是 | 主键 |
| userId | ObjectId | 是 | 用户 ID |
| items | Array | 是 | 商品项 |
| updatedAt | Date | 是 | 更新时间 |

**items 子结构：**
```json
{
  "productId": "ObjectId",
  "name": "商品名",
  "image": "主图URL",
  "price": 12.5,
  "quantity": 2,
  "spec": "规格（如：原味）"
}
```

**索引建议：**
- `userId`：唯一索引（一人一车，按用户查）

---

## 5. 订单表 (orders)

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| _id | ObjectId | 是 | 主键 |
| orderNo | String | 是 | 订单编号，唯一 |
| userId | ObjectId | 是 | 用户 ID |
| items | Array | 是 | 商品明细 |
| totalAmount | Number | 是 | 总金额 |
| status | String | 是 | 状态：pending/paid/preparing/shipping/done/cancelled |
| type | String | 是 | 类型：delivery 配送 / dinein 堂食 |
| address | Object | 否 | 配送地址（delivery 时必填） |
| paymentMethod | String | 否 | 支付方式：wechat / alipay |
| paidAt | Date | 否 | 支付时间 |
| createdAt | Date | 是 | 创建时间 |
| updatedAt | Date | 是 | 更新时间 |

**items 子结构：**
```json
{
  "productId": "ObjectId",
  "name": "商品名",
  "image": "图片URL",
  "price": 12.5,
  "quantity": 2,
  "spec": "规格",
  "amount": 25
}
```

**address 子结构：**
```json
{
  "name": "收货人",
  "phone": "13800138000",
  "region": "省市区",
  "detail": "详细地址"
}
```

**订单状态流转：**
```
pending → paid → preparing → shipping → done
         ↓
      cancelled
```

**索引建议：**
- `orderNo`：唯一索引（查单、防重复）
- `userId`：普通索引（用户订单列表）
- `userId + createdAt`：复合索引（用户订单时间排序）
- `status`：普通索引（管理端按状态筛选）
- `createdAt`：普通索引（时间范围查询）

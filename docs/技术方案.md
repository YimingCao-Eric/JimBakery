# 技术方案总览

## 1. 技术栈选型

### 前端
- **框架**：微信小程序原生框架
- **UI 组件**：WeUI + 自定义组件
- **图表库**：ECharts-for-weixin / F2（数据看板用）
- **状态管理**：MobX-miniprogram / 原生方案

### 后端
- **运行时**：Node.js 18+
- **框架**：Express / NestJS（推荐 NestJS）
- **数据库**：MongoDB / MySQL（根据团队熟悉度选择）
- **缓存**：Redis（会话、热点数据）
- **ORM**：Mongoose（MongoDB）/ TypeORM（MySQL）

### 第三方服务
- **支付**：微信支付 API + 支付宝小程序支付
- **存储**：微信云存储 / 阿里云 OSS
- **推送**：微信订阅消息
- **部署**：阿里云/腾讯云 + Docker

---

## 2. 架构设计

### 2.1 整体架构

采用 **前后端分离** 架构，小程序作为纯展示与交互层，通过 RESTful API 与后端服务通信，后端负责业务逻辑、数据持久化与第三方能力对接。

```
┌─────────────────┐     HTTPS      ┌─────────────────┐     ┌─────────────────┐
│  微信小程序      │  ──────────►  │  后端 API 服务   │  ──►│  数据库         │
│  (前端)         │  RESTful API  │  (Node.js)       │     │  (MongoDB/MySQL) │
└─────────────────┘               └────────┬────────┘     └─────────────────┘
        │                                    │                       ▲
        │ 微信登录 / 支付                     │                       │
        ▼                                    ▼                       │
┌─────────────────┐               ┌─────────────────┐                 │
│  微信开放平台    │               │  Redis 缓存     │────────────────┘
│  (登录/支付/推送) │               │  (会话/热点)    │
└─────────────────┘               └─────────────────┘
```

### 2.2 数据流转

1. **小程序前端**：负责页面渲染、用户交互、本地缓存（购物车、用户偏好等）
2. **RESTful API**：标准化接口，支持 JSON 请求/响应
3. **后端服务**：校验 JWT、执行业务逻辑、访问数据库与缓存
4. **数据库**：持久化业务数据（用户、商品、订单等）

### 2.3 认证流程（JWT Token）

```
1. 用户点击「微信登录」
   └─► 小程序调用 wx.login() 获取 code

2. 小程序将 code 发送至后端 /auth/login
   └─► 后端用 code 调用微信接口换取 openid、session_key

3. 后端生成 JWT Token，返回给小程序
   └─► Token 存入本地 Storage，请求头携带 Authorization: Bearer <token>

4. 后续请求自动携带 Token
   └─► 后端中间件校验 Token，解析用户身份

5. Token 过期（401）
   └─► 清除本地 Token，引导用户重新登录
```

### 2.4 接口规范

- **基础路径**：`/api/v1`
- **请求头**：`Content-Type: application/json`，`Authorization: Bearer <token>`
- **响应格式**：`{ code: 0|200, data: {}, message: '' }`
- **错误码**：401 未授权，403 无权限，500 服务端错误

# 🍞 面包店微信小程序 - 项目需求文档

---

## 一、项目概述

| 项目属性 | 说明 |
|----------|------|
| **项目名称** | JimBakery 面包店微信小程序 |
| **目标平台** | 微信小程序 |
| **用户角色** | 顾客（C端）、店长（B端） |
| **服务模式** | 外送配送 + 店内堂食 |

---

## 二、技术栈建议

### 2.1 前端
| 技术 | 说明 |
|------|------|
| 框架 | 微信小程序原生框架 / Taro 3.x / uni-app |
| UI组件 | WeUI + 自定义组件 |
| 图表库 | ECharts 小程序版本 / F2 图表库 |
| 状态管理 | MobX-miniprogram / 原生方案 |

### 2.2 后端
| 技术 | 说明 |
|------|------|
| 运行时 | Node.js 18+ |
| 框架 | Express / NestJS（推荐NestJS） |
| 数据库 | MongoDB / MySQL |
| 缓存 | Redis（会话、热点数据） |
| ORM | Mongoose / TypeORM |

### 2.3 第三方服务
| 服务 | 用途 |
|------|------|
| 微信支付 API | 用户端支付 |
| 支付宝小程序支付 | 备用支付方式 |
| 微信云存储 / 阿里云OSS | 图片文件存储 |
| 微信订阅消息 | 订单状态推送 |

---

## 三、用户端（顾客）功能模块

### 3.1 用户系统

#### 登录注册
- 微信一键登录（`wx.login`）
- 获取用户 `openid`、头像、昵称
- 手机号绑定（`getPhoneNumber`）

#### 用户信息管理
- 修改头像、昵称
- 收货地址管理：新增、编辑、删除、设置默认地址

#### 历史订单
- 查看全部订单（待支付、已支付、配送中、已完成）
- 订单详情页（商品列表、金额、配送信息）

### 3.2 菜单展示

#### 分类导航
- 横向滚动分类栏（巴斯克、慕斯、面包、蛋糕、饮品等）
- 吸顶效果

#### 商品列表
- 瀑布流/网格布局展示商品卡片
- 商品卡片信息：图片、名称、价格、销量

#### 商品详情
- 大图轮播展示
- 详细描述
- 规格选择（尺寸/口味）
- 加入购物车按钮

#### 搜索功能
- 按商品名称搜索
- 历史搜索记录

### 3.3 购物车与支付（外送）

#### 购物车管理
- 添加商品
- 修改数量
- 删除商品
- 清空购物车
- 显示总价

#### 结算流程
```
选择收货地址 → 确认订单 → 选择支付方式 → 支付 → 订单生成
```

#### 支付方式
- 微信支付（优先）
- 支付宝支付（备用）

#### 订单追踪
- 支付成功后生成订单
- 显示预计送达时间

---

## 四、店长端功能模块

### 4.1 数据看板（Dashboard）

#### 今日概览
- 今日销售额
- 订单数
- 客单价

#### 实时营收图表
- **每小时销售额折线图**（0-24点，实时更新）
- **近30天销售趋势图**（每日销售额对比）

#### 产品销售占比
- 今日/本周/本月各品类销售饼图
- 巴斯克、慕斯、面包等占比

#### 热销排行
- TOP10 热销商品列表

### 4.2 订单管理

#### 订单列表
- 全部订单、待处理、配送中、已完成、已取消
- 按日期、状态、订单号筛选

#### 订单操作
- 确认订单
- 取消订单
- 标记配送完成

#### 订单详情
- 顾客信息
- 商品清单
- 金额明细
- 配送地址

### 4.3 菜单管理（CMS）

#### 分类管理
- 新增分类
- 编辑分类名称
- 调整分类排序
- 删除空分类

#### 商品CRUD
| 功能 | 说明 |
|------|------|
| 新增商品 | 名称、分类、价格、库存、描述、上传图片（支持多张） |
| 编辑商品 | 修改所有字段、上下架状态 |
| 删除商品 | 软删除（标记为下架而非物理删除） |

#### 库存管理
- 设置库存数量
- 库存不足提醒

### 4.4 堂食点单系统

#### 快速点单
- 类似用户端的商品浏览
- 界面优化为店员快速操作

#### 购物车
- 添加商品
- 修改数量
- 备注（如少糖、加热）

#### 支付展示
- 生成收款二维码（微信/支付宝）
- 支持顾客扫码支付

#### 小票打印（可选）
- 连接蓝牙打印机
- 打印订单小票

---

## 五、数据模型设计

### 5.1 用户表（users）

```javascript
{
  _id: ObjectId,           // 主键
  openid: String,          // 微信openid，唯一
  nickname: String,        // 昵称
  avatar: String,          // 头像URL
  phone: String,           // 手机号
  role: String,            // 角色：user/admin
  addresses: Array,        // 收货地址列表
  createdAt: Date,
  updatedAt: Date
}
```

### 5.2 商品分类表（categories）

```javascript
{
  _id: ObjectId,
  name: String,            // 分类名称
  icon: String,            // 图标URL
  sort: Number,            // 排序
  isActive: Boolean        // 是否启用
}
```

### 5.3 商品表（products）

```javascript
{
  _id: ObjectId,
  name: String,            // 商品名称
  categoryId: ObjectId,    // 分类ID
  price: Number,           // 价格
  originalPrice: Number,   // 原价
  stock: Number,           // 库存
  images: Array,           // 图片URL数组
  description: String,     // 描述
  specs: Array,            // 规格选项
  sales: Number,           // 销量统计
  isActive: Boolean        // 是否上架
}
```

### 5.4 购物车表（carts）

```javascript
{
  _id: ObjectId,
  userId: ObjectId,        // 用户ID
  items: Array,            // 商品项
    // { productId, name, image, price, quantity, spec }
  updatedAt: Date
}
```

### 5.5 订单表（orders）

```javascript
{
  _id: ObjectId,
  orderNo: String,         // 订单编号
  userId: ObjectId,        // 用户ID
  items: Array,            // 商品明细
    // [{ productId, name, price, quantity }]
  totalAmount: Number,     // 总金额
  status: String,          // 状态
    // pending / paid / delivering / completed / cancelled
  type: String,            // 类型
    // delivery(外送) / dinein(堂食)
  address: Object,         // 配送地址（外送）
  paymentMethod: String,   // wechat / alipay
  paidAt: Date,            // 支付时间
  createdAt: Date
}
```

---

## 六、关键业务流程

### 6.1 用户下单流程（外送）

```
浏览商品 → 加入购物车 → 确认地址 → 发起支付 
    ↓
支付回调 → 订单确认 → 店长接单 → 配送 → 完成
```

### 6.2 店长堂食流程

```
选择商品 → 加入购物车 → 生成收款码 
    ↓
顾客扫码支付 → 打印小票 → 制作完成
```

### 6.3 数据更新机制

- 订单完成后自动更新销售数据
- 图表数据按小时/天聚合

---

## 七、非功能性需求

### 7.1 性能要求
| 指标 | 要求 |
|------|------|
| 页面加载 | < 2秒 |
| 图片加载 | 懒加载 |
| 列表渲染 | 分页加载 |

### 7.2 安全要求
| 项目 | 措施 |
|------|------|
| 支付安全 | 支付签名验证 |
| 接口安全 | 敏感接口鉴权 |
| 防刷单 | 频率限制、验证码 |

### 7.3 用户体验
| 项目 | 实现 |
|------|------|
| 加载状态 | 骨架屏 |
| 操作反馈 | Toast提示 |
| 异常处理 | 网络异常、空状态 |

### 7.4 兼容性
- 适配主流手机尺寸（iPhone/Android 全面屏）
- 微信基础库版本兼容

---

## 八、页面路由规划

### 8.1 用户端（TabBar页面）

| 路径 | 页面 | 说明 |
|------|------|------|
| `/pages/index/index` | 首页 | 轮播图、分类入口、推荐商品 |
| `/pages/menu/menu` | 菜单 | 分类导航、商品列表、搜索 |
| `/pages/cart/cart` | 购物车 | 商品列表、数量修改、结算 |
| `/pages/order/order` | 订单 | 订单列表、状态筛选 |
| `/pages/user/user` | 我的 | 用户信息、地址管理、历史记录 |

### 8.2 用户端（子页面）

| 路径 | 页面 | 说明 |
|------|------|------|
| `/pages/product-detail/product-detail` | 商品详情 | 轮播图、规格选择、加入购物车 |
| `/pages/order-confirm/order-confirm` | 订单确认 | 地址选择、商品确认、支付 |
| `/pages/order-detail/order-detail` | 订单详情 | 订单信息、物流追踪 |
| `/pages/address-list/address-list` | 地址列表 | 增删改查收货地址 |
| `/pages/address-edit/address-edit` | 编辑地址 | 表单填写 |
| `/pages/search/search` | 搜索 | 搜索框、历史记录、热门搜索 |

### 8.3 店长端（分包 pages_admin）

| 路径 | 页面 | 说明 |
|------|------|------|
| `/pages_admin/dashboard/dashboard` | 数据看板 | 营收统计、图表展示 |
| `/pages_admin/products/products` | 商品管理 | 列表、搜索、筛选 |
| `/pages_admin/product-edit/product-edit` | 编辑商品 | 表单、图片上传 |
| `/pages_admin/categories/categories` | 分类管理 | 列表、排序 |
| `/pages_admin/orders/orders` | 订单管理 | 列表、筛选、操作 |
| `/pages_admin/order-detail/order-detail` | 订单详情 | 订单信息、操作按钮 |
| `/pages_admin/settings/settings` | 设置 | 店铺信息、营业时间 |

---

## 九、开发里程碑

| 周次 | 里程碑 | 完成内容 |
|------|--------|----------|
| Week 1 | 基础架构完成 | 环境搭建、数据库设计、基础组件 |
| Week 2 | 用户端核心完成 | 登录、菜单、购物车 |
| Week 3 | 支付系统完成 | 双支付集成、订单系统、用户端V1.0 |
| Week 4 | 数据看板完成 | 实时营收图表、销售分析 |
| Week 5 | 菜单管理完成 | 分类/商品CRUD、图片上传 |
| Week 6 | 堂食系统完成 | 堂食点单、收款码、订单管理 |
| Week 7 | 项目上线 | 测试优化、安全加固、正式上线 |

---

## 十、风险提示

| 风险 | 说明 | 应对措施 |
|------|------|----------|
| 支付审核风险 | 微信支付商户资质审核需3-7个工作日 | Week 1立即申请 |
| 小程序审核风险 | 首次审核需1-3天 | Week 7预留缓冲时间 |
| 图片存储成本 | 需预估图片量 | 选择合适的存储方案 |
| 并发处理 | 高峰期订单并发 | 做好库存扣减的幂等处理 |

---

*文档版本：v1.0*  
*最后更新：2026-02-11*
